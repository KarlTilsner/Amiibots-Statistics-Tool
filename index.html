<!DOCTYPE html>
<html>
    <head>
        <meta charset="UFT-8">
        <meta name="Amiibots Statistics Tool" content="width = device-width", initial-scale = "1.0">
        <title>Amiibots Statistics Tool</title>

        <link rel="shortcut icon" type="image/x-icon" href="favicon.ico" />

        <link rel="stylesheet" href="css/styles.css">
        <script src="js/fetch_data.js"></script>

        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/chartjs-plugin-datalabels/2.2.0/chartjs-plugin-datalabels.min.js" 
                integrity="sha512-JPcRR8yFa8mmCsfrw4TNte1ZvF1e3+1SdGMslZvmrzDYxS69J7J49vkFL8u6u8PlPJK+H3voElBtUCzaXj+6ig==" 
                crossorigin="anonymous" 
                referrerpolicy="no-referrer"></script>
    </head>





    <body>
        <div class="header">
            <h1 class="title">Amiibots Statistics Tool</h1> 
            <p class="version">v1.0.4</p>

            <p> This version of the program has been limited to search 5000 matches for a specific trainer. <br>
                This has been done so that Untitled and I know the amiibots system can handle many large searches at once. <br>
                Please note that search times can take up to 20 seconds, please be patient :D
            </p>
        </div>



        <div class="block flex_container">
            <div class="sub_container search_bar">
                <form>
                    <input type="text"  id="twitch_name"     name="twitch_name"      placeholder="Enter Your Amiibots ID Here">
                    <input type="text"  id="amiibo_name"     name="amiibo_name"      placeholder="Enter Your Amiibo's ID Here">
                    <input type="text"  id="ruleset"         name="ruleset"          placeholder="Enter The Ruleset Here">

                    <div class="search_buttons">
                        <input type="button"    value="Save Search Parameters"  class="search_button"   id="button" onclick="searchParameters()" required></form>
                        <input type="button"    value="Generate Graph"          class="generate_graph"  id="button" onclick="window.location.reload()" required></form>
                        <input type="button"    value="ID Search Tool"          class="id_search"       id="button" onclick="window.location.href = 'id_search.html'" required></form>
                    </div>
                </form>
            </div>
        
            <div class="sub_container quick_statistics">
                <p class="stats" id="amiibo_rating">Current Rating: Calculating...</p>
                <p class="stats" id="amiibo_rating_max">Highest Rating: Calculating...</p>
                <p class="stats" id="amiibo_rating_mu">Current Rating mu: Calculating...</p>
                <p class="stats" id="amiibo_rating_sigma">Current Rating Sigma: Calculating...</p>
            </div>

            <div class="sub_container quick_statistics">
                <p class="stats" id="amiibo_rank_overall">Rank (Overall): Calculating...</p>
                <p class="stats" id="amiibo_rank_character">Rank (Character): Calculating...</p>
                <p class="stats" id="amiibo_next_rank_overall">Next Rank (Overall): Calculating...</p>
                <p class="stats" id="amiibo_next_rank_character">Next Rank (Character): Calculating...</p>
            </div>
        </div>

        

        <!-- <div class="block">
            <div class="flex_container">
                <div class="sub_container flex_box">
                    <p>Number of amiibo:</p>
                    <p>Calculating...</p>
                </div>

                <div class="sub_container flex_box">
                    <p>Number of vanilla amiibo:</p>
                    <p>Calculating...</p>
                </div>

                <div class="sub_container flex_box">
                    <p>Number of b5b amiibo:</p>
                    <p>Calculating...</p>
                </div>

                <div class="sub_container flex_box">
                    <p>Number of AG amiibo:</p>
                    <p>Calculating...</p>
                </div>
            </div>
        </div> -->



        <div class="block">
            <div class="container rating_history">
                <canvas id="rating_history_chart_canvas"></canvas>
            </div>
        </div>



        <div class="block">
            <div class="container amiibo_lost_to" id="amiibo_lost_to">
                <canvas id="amiibo_lost_to_chart_canvas"></canvas>
            </div>
        </div>





    <script>

//                                                              FEATURES TO WORK ON
//--------------------------------------------------------------------------------------------------------------------------------------------------------- 
//                                                              
//                                                              SIDEBAR THAT CONTAINS USEFUL THINGS
//                                                              CHART COLOUR THEME PAGE
//                                                              
//                                                              CLICK LISTED AMIIBO AND START GRAPHING THE STATS
//                                                              
//                                                              LIST NUMBER OF AMIIBO A USER HAS
//                                                              SORT MATCHUPS INTO TIERLIST
//                                                              
//                                                              
//                                                              AUTO SEARCH NUMBER OF MATCHES TRAINER HAS PLAYED
//                                                              
//                                                              
//                                                              IMPROVE CSS
//                                                              CLEAN UP CODE
//                                                              



/*
Change Log:
v1.0.3
- Added Amiibots ID search
    - Type in a Twitch username or Amiibots display name to search for the hidden Amiibots ID
    - Type in a Twitch username or Amiibots display name to search for all amiibo IDs a trainer has
- Highest rating value is now highlighted on the rating history

v1.0.2
- Overhauled CSS code
    - Cleaned up CSS
    - Elements scale much better
    - Added future support for themes
- Added leaderboard information
    - Displays current rank overall and based on character
    - Displays rating until next rank overall and based on character

v1.0.1
- Added disclaimer message
- Cleaned up JS code
- Fixed charts not displaying ruleset
- Increased width of charts
- Changed font sizes

v1.0.0
- Added rating history chart
- Added character matchup chart
- Added search fields
- Added some hidden statistics
- Added current rating and max rating
- Searches are saved in LocalStorage
- ID's and ruleset are shown in search fields
- Character matchup chart scales with number of characters displayed
- Character matchup chart displays win %
*/



//                                                              GRAPH RATING HISTORY
//---------------------------------------------------------------------------------------------------------------------------------------------------------
            //Draw chart onto a canvas
            async function RatingHistoryChart() {
            await fetchData();

            const rating_history_chart = document.getElementById('rating_history_chart_canvas');  
                new Chart(rating_history_chart, {
                    type: 'line',
                    
                    data: {
                        labels: xAxis,
                        datasets: [{
                            label: `Rating History of: ${amiibo_name[0]} (${window.localStorage.getItem("Ruleset")})`,
                            data: yAxis,
                            backgroundColor: primary_background_colour,
                            borderColor: primary_border_colour,
                            fill: true,
                            borderWidth: 1,
                            pointRadius: 1,
                            pointHoverRadius: 1
                            },
                            {
                            label: `Highest Rating`,
                            data: yAxisBar,
                            backgroundColor: secondary_background_colour, 
                            borderColor: secondary_border_colour, 
                            fill: true,
                            borderWidth: 1,
                            pointRadius: 1,
                            pointHoverRadius: 1,
                            type: 'bar',
                        }]
                    },
                    
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            x: {
                                grid: {
                                    display: false
                                },
                                title: {
                                    display: true,
                                    text: 'Games Played'
                                }
                            },
                            y: {
                                beginAtZero: true,
                                grid: {
                                    color: 'rgba(200, 200, 200, 0.2)'
                                },
                                title: {
                                    display: true,
                                    text: 'Rating Over Time'
                                }
                            }
                        }
                    } 
                });
            }

//                                                              GRAPH AMIIBO LOST TO
//---------------------------------------------------------------------------------------------------------------------------------------------------------
            async function characterMatchupChart() {
            await RatingHistoryChart();
            
            const graph_height = ((character_name_count.length * 20) + 100);

            // console.log(graph_height);
            
            document.getElementById('amiibo_lost_to').setAttribute("style", `height:${graph_height}px`);

            const character_matchup_chart = document.getElementById('amiibo_lost_to_chart_canvas');  
                new Chart(character_matchup_chart, {
                    type: 'bar',
                    
                    data: {
                        labels: character_win_rate,
                        datasets: [{
                            label: `Characters ${amiibo_name[0]} Has Lost To (${window.localStorage.getItem("Ruleset")})`,
                            data: character_id_count,
                            backgroundColor: primary_background_colour,
                            borderColor: primary_border_colour,
                            fill: true,
                            borderWidth: 1
                        },
                        {
                            label: `Characters ${amiibo_name[0]} Has Defeated (${window.localStorage.getItem("Ruleset")})`,
                            data: character_defeated_id_count,
                            backgroundColor: secondary_background_colour,
                            borderColor: secondary_border_colour,
                            fill: true,
                            borderWidth: 1
                        }]
                    },
                    
                    options: {
                        indexAxis: 'y',
                        responsive: true,
                        maintainAspectRatio: false,
                                                scales: {
                            x: {
                                stacked: true,
                                title: {
                                    display: true,
                                    text: 'Times Defeated'
                                },
                            },
                            y: {
                                stacked: true,
                            },
                        }
                    },
                    plugins: [ChartDataLabels], 
                    labels: {
                        fontColor: 'rgba(170, 200, 100, 1)',
                    }
                });
            }
            characterMatchupChart();

//                                                              END OF SCRIPT
//---------------------------------------------------------------------------------------------------------------------------------------------------------
        </script>
    </body>
</html>