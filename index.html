<!DOCTYPE html>
<html>
    <head>
        <meta charset="UFT-8">
        <meta name="Amiibots Statistics Tool" content="width = device-width", initial-scale = "1.0">
        <title>Amiibots Statistics Tool</title>

        <link rel="shortcut icon" type="image/x-icon" href="favicon.ico" />

        <link rel="stylesheet" href="css/styles.css">
        <script src="js/fetch_data.js"></script>

        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/chartjs-plugin-datalabels/2.2.0/chartjs-plugin-datalabels.min.js" 
                integrity="sha512-JPcRR8yFa8mmCsfrw4TNte1ZvF1e3+1SdGMslZvmrzDYxS69J7J49vkFL8u6u8PlPJK+H3voElBtUCzaXj+6ig==" 
                crossorigin="anonymous" 
                referrerpolicy="no-referrer"></script>
    </head>


    <body>
        <div class="header">
            <h1 class="header_text">Amiibots Statistics Tool</h1> <p class="header_text" id="version">v1.0.1</p>
            <div>
                <p> This version of the program has been limited to search 5000 matches for a specific trainer. <br>
                    This has been done so that Untitled and I know the amiibots system can handle many large searches at once. <br>
                    Please note that search times can take up to 20 seconds, please be patient :D
                </p>
            </div>
        </div>

        <div class="topbar">
            <div class="sumbmission_field">
                <form>
                    <input type="text" id="twitch_name" name="twitch_name" placeholder="Enter Your Twitch Username Here">
                    <input type="text" id="amiibo_name" name="amiibo_name" placeholder="Enter Your Amiibo's Name Here">
                    <input type="text" id="ruleset" name="ruleset" placeholder="Enter The Ruleset Here">

                    <div class="flex">
                        <input type="button" value="Save Search Parameters" id="search_parameters" class="search_button" id="button" onclick="searchParameters()" required></form>
                        <input type="button" value="Generate Graph" id="search_parameters" class="generate_graph" id="button" onclick="window.location.reload()" required></form>
                    </div>
                </form>
            </div>

            <div class="statistics">
                <p class="stats_text" id="amiibo_rating">Current Rating: Calculating...</p>
                <p class="stats_text" id="amiibo_rating_max">Highest Rating: Calculating...</p>
                <p class="stats_text" id="amiibo_rating_mu">Current Rating mu: Calculating...</p>
                <p class="stats_text" id="amiibo_rating_sigma">Current Rating Sigma: Calculating...</p>
            </div>
        </div>

        <div class="rating_history">
            <canvas id="rating_history"></canvas>
        </div>

        <div class="amiibo_lost_to" id="amiibo_lost_to">
            <canvas id="amiibo_lost_to_graph"></canvas>
        </div>
    <script>

//                                                              FEATURES TO WORK ON
//--------------------------------------------------------------------------------------------------------------------------------------------------------- 
//                                                              TUTORIAL TO FIND IDs
//                                                              AUTO SEARCH NUMBER OF MATCHES TRAINER HAS PLAYED
//                                                              CLEAN UP CODE





//                                                              GRAPH RATING HISTORY
//---------------------------------------------------------------------------------------------------------------------------------------------------------
            //Draw chart onto a canvas
            async function RatingHistoryGraph() {
            await dataGenerator();

            const RH = document.getElementById('rating_history');  
                new Chart(RH, {
                    type: 'line',
                    
                    data: {
                        labels: xAxis,
                        datasets: [{
                            label: `Rating History of: ${amiibo_name[0]} (${window.localStorage.getItem("Ruleset")})`,
                            data: yAxis,
                            backgroundColor: 'rgba(255, 99, 132, 0.2)',
                            borderColor: 'rgba(255, 99, 132, 1)',
                            fill: true,
                            borderWidth: 1,
                            pointRadius: 1,
                            pointHoverRadius: 1
                        }]
                    },
                    
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            x: {
                                grid: {
                                    display: false
                                },
                                title: {
                                    display: true,
                                    text: 'Games Played'
                                }
                            },
                            y: {
                                beginAtZero: true,
                                grid: {
                                    color: 'rgba(200, 200, 200, 0.2)'
                                },
                                title: {
                                    display: true,
                                    text: 'Rating Over Time'
                                }
                            }
                        }
                    } 
                });
            }

//                                                              GRAPH AMIIBO LOST TO
//---------------------------------------------------------------------------------------------------------------------------------------------------------
            async function chartArea1() {
            await RatingHistoryGraph();
            
            const graph_height = ((character_name_count.length * 20) + 100);

            console.log(graph_height);
            
            document.getElementById('amiibo_lost_to').setAttribute("style", `height:${graph_height}px`);

            const ALT = document.getElementById('amiibo_lost_to_graph');  
                new Chart(ALT, {
                    type: 'bar',
                    
                    data: {
                        labels: character_win_rate,
                        datasets: [{
                            label: `Characters ${amiibo_name[0]} Has Lost To (${window.localStorage.getItem("Ruleset")})`,
                            data: character_id_count,
                            backgroundColor: 'rgba(255, 99, 132, 0.2)',
                            borderColor: 'rgba(255, 99, 132, 1)',
                            fill: true,
                            borderWidth: 1
                        },
                        {
                            label: `Characters ${amiibo_name[0]} Has Defeated (${window.localStorage.getItem("Ruleset")})`,
                            data: character_defeated_id_count,
                            backgroundColor: 'rgba(170, 200, 100, 0.2)',
                            borderColor: 'rgba(170, 200, 100, 1)',
                            fill: true,
                            borderWidth: 1
                        }]
                    },
                    
                    options: {
                        indexAxis: 'y',
                        responsive: true,
                        maintainAspectRatio: false,
                                                scales: {
                            x: {
                                stacked: true,
                                title: {
                                    display: true,
                                    text: 'Times Defeated'
                                },
                            },
                            y: {
                                stacked: true,
                            },
                        }
                    },
                    plugins: [ChartDataLabels], 
                    labels: {
                        fontColor: 'rgba(170, 200, 100, 1)',
                    }
                });
            }
            chartArea1 ();

//                                                              END OF SCRIPT
//---------------------------------------------------------------------------------------------------------------------------------------------------------
        </script>
    </body>
</html>
